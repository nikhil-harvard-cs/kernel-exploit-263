Exploit should clean up after itself (fix corrupted data structures) so that it does not immediately crash.
Bypass KASLR

Modify the exploit code to use exploitlib's arbitrary read/write exploit function: keep in mind the library function expects to be passed functions that read/write 8 bytes at a time: in this exploit the primitive is 4 bytes at a time.
The makefile target.mk is included to help with this, the actual Makefile should be changed to this once the exploit code is modified to use the library.
