SHELL=/bin/bash
BUILD_DIR=build
obj-m += vuln.o
vuln-objs += arbrw.o uaf.o main.o
KERNELDIR ?= /lib/modules/$(shell uname -r)/build
PWD := $(shell pwd)

define compile
	$(MAKE) -C $(KERNELDIR) M=$(PWD) modules
	@rm -rf ${BUILD_DIR}
	@mkdir ${BUILD_DIR}
	@mv -f *.o *.ko *.mod.c .*.cmd ${BUILD_DIR}
endef
	
default:
	@$(call compile)
	
install:
	@$(call compile)
	insmod ${BUILD_DIR}/vuln.ko
	
clean:
	rm -rf ${BUILD_DIR}
	$(MAKE) -C $(KERNELDIR) M=$(PWD) clean
	
remove:
	rm -rf ${BUILD_DIR}
	$(MAKE) -C $(KERNELDIR) M=$(PWD) clean
	rmmod vuln
